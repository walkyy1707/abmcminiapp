(this["webpackJsonpABMCBOT-frontend"]=this["webpackJsonpABMCBOT-frontend"]||[]).push([[0],{12:function(e,t,a){},13:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(2),c=a.n(i);var l=function(e){let{initData:t}=e;const[a,i]=Object(n.useState)(null),[c,l]=Object(n.useState)(!1);Object(n.useEffect)(()=>{o()},[t]);const o=async()=>{try{const e=await fetch("/user?start_param="+encodeURIComponent(window.Telegram.WebApp.initDataUnsafe.start_param||""),{headers:{Authorization:"Bearer "+t}});if(!e.ok)throw new Error("Failed to fetch user data");const a=await e.json();i(a)}catch(e){console.error("Error fetching user data:",e)}};return a?r.a.createElement("div",null,r.a.createElement("p",null,"Points: ",a.points),r.a.createElement("p",null,"Tickets: ",a.tickets,"/7"),r.a.createElement("button",{onClick:async()=>{l(!0);try{const e=await fetch("/claim_ticket",{method:"POST",headers:{Authorization:"Bearer "+t}});if(!e.ok)throw new Error("Failed to claim ticket");const a=await e.json();i(e=>({...e,tickets:a.tickets}))}catch(e){console.error("Error claiming ticket:",e),alert("Failed to claim ticket. Please try again.")}finally{l(!1)}},disabled:c||a.tickets>=7||a.last_ticket_date===(new Date).toISOString().split("T")[0]},c?"Claiming...":"Claim Daily Ticket")):r.a.createElement("p",null,"Loading...")};var o=function(e){let{initData:t}=e;const[a,i]=Object(n.useState)(0),[c,l]=Object(n.useState)(!1),[o,s]=Object(n.useState)(0),u=Object(n.useRef)(null),m=Object(n.useRef)([]),d=Object(n.useRef)(new Audio("/sounds/catch.mp3"));Object(n.useEffect)(()=>{fetch("/user",{headers:{Authorization:"Bearer "+t}}).then(e=>e.json()).then(e=>i(e.tickets))},[]),Object(n.useEffect)(()=>{const e=u.current;if(!e)return;const t=e.getContext("2d");let a;const n=()=>{c&&(t.clearRect(0,0,e.width,e.height),m.current.forEach(a=>{a.y+=a.speed,a.y>e.height?m.current=m.current.filter(e=>e!==a):(t.beginPath(),t.arc(a.x,a.y,10,0,2*Math.PI),t.fillStyle="green",t.fill())}),m.current.length<20&&Math.random()<.1&&m.current.push({x:Math.random()*e.width,y:0,speed:2+2*Math.random()}),a=requestAnimationFrame(n))};return c&&n(),()=>cancelAnimationFrame(a)},[c]);const h=async()=>{await fetch("/submit_score",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t},body:JSON.stringify({score:o})})};return r.a.createElement("div",null,c?r.a.createElement("div",null,r.a.createElement("canvas",{ref:u,width:"300",height:"400",onClick:e=>{if(!c)return;const t=u.current.getBoundingClientRect(),a=e.clientX-t.left,n=e.clientY-t.top;m.current=m.current.filter(e=>!(Math.hypot(e.x-a,e.y-n)<10)||(s(e=>e+10),d.current.play(),!1))}}),r.a.createElement("p",null,"Score: ",o)):r.a.createElement("button",{onClick:async()=>{(await fetch("/play_game",{method:"POST",headers:{Authorization:"Bearer "+t}})).ok&&(l(!0),s(0),m.current=[],i(e=>e-1),setTimeout(()=>{l(!1),h()},25e3))},disabled:a<=0},"Play (Tickets: ",a,")"))};var s=function(e){let{initData:t}=e;const[a,i]=Object(n.useState)([]),[c,l]=Object(n.useState)([]);return Object(n.useEffect)(()=>{fetch("/missions").then(e=>e.json()).then(i),fetch("/user_missions",{headers:{Authorization:"Bearer "+t}}).then(e=>e.json()).then(l)},[]),r.a.createElement("div",null,a.map(e=>r.a.createElement("div",{key:e.mission_id,className:"mission"},r.a.createElement("p",null,e.description),r.a.createElement("a",{href:e.link,target:"_blank",rel:"noopener noreferrer"},"Go"),c.includes(e.mission_id)?r.a.createElement("p",null,"\u2714 Completed"):r.a.createElement("button",{onClick:()=>(async e=>{(await fetch("/complete_mission",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t},body:JSON.stringify({mission_id:e})})).ok&&l(t=>[...t,e])})(e.mission_id)},"Complete"))))};var u=function(e){let{initData:t,userId:a}=e;const[i,c]=Object(n.useState)(0),l="https://t.me/officialabmcbot/app?startapp=ref_"+a;return Object(n.useEffect)(()=>{fetch("/referrals",{headers:{Authorization:"Bearer "+t}}).then(e=>e.json()).then(e=>c(e.referrals))},[]),r.a.createElement("div",null,r.a.createElement("p",null,"Referral Link: ",r.a.createElement("input",{type:"text",value:l,readOnly:!0})),r.a.createElement("p",null,"Referrals: ",i))};var m=function(){const[e,t]=Object(n.useState)([]);return Object(n.useEffect)(()=>{fetch("/leaderboard").then(e=>e.json()).then(t)},[]),r.a.createElement("div",null,r.a.createElement("h2",null,"Leaderboard"),r.a.createElement("ul",null,e.map((e,t)=>r.a.createElement("li",{key:t},e.telegram_id,": ",e.points," points"))))};a(12);var d=function(){const[e,t]=Object(n.useState)("home"),[a,i]=Object(n.useState)(""),[c,d]=Object(n.useState)(null);return Object(n.useEffect)(()=>{if(window.Telegram&&window.Telegram.WebApp){const e=window.Telegram.WebApp;e.ready(),i(e.initData),d(e.initDataUnsafe.user)}},[]),c?r.a.createElement("div",{className:"app"},r.a.createElement("h1",null,"ABMC by HSC"),r.a.createElement("nav",null,r.a.createElement("button",{onClick:()=>t("home")},"Home"),r.a.createElement("button",{onClick:()=>t("game")},"Game"),r.a.createElement("button",{onClick:()=>t("missions")},"Missions"),r.a.createElement("button",{onClick:()=>t("referral")},"Referral"),r.a.createElement("button",{onClick:()=>t("leaderboard")},"Leaderboard")),"home"===e&&r.a.createElement(l,{initData:a}),"game"===e&&r.a.createElement(o,{initData:a}),"missions"===e&&r.a.createElement(s,{initData:a}),"referral"===e&&r.a.createElement(u,{initData:a,userId:c.id}),"leaderboard"===e&&r.a.createElement(m,null)):r.a.createElement("div",null,"Loading...")};c.a.createRoot(document.getElementById("root")).render(r.a.createElement(d,null))},3:function(e,t,a){e.exports=a(13)}},[[3,1,2]]]);
//# sourceMappingURL=main.be7e442e.chunk.js.map